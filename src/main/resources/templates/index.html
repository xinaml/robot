<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<html>
<head>
    <meta charset="utf-8">
    <title>首页</title>
    <link rel="stylesheet" href="../bootstrap/css/bootstrap.css"/>
    <link rel="stylesheet" href="../bootstrap/css/bootstrap-table.min.css"/>
    <link rel="stylesheet" href="../bootstrap/css/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="../toastr/toastr.min.css">
    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../bootstrap/js/bootstrap.js"></script>
    <script src="../bootstrap/js/bootstrap-table.min.js"></script>
    <script src="../bootstrap/js/bootstrap-table-zh-CN.js"></script>
    <script src="../bootstrap/js/bootstrap-datetimepicker.min.js"></script>
    <script src="../bootstrap/js/bootstrap-datetimepicker.zh-CN.js"></script>
    <script src="../toastr/toastr.min.js"></script>
    <script src="../js/common/common.js"></script>

</head>
<body>
<div id="top" style="height: 50px;float: right;padding-top: 10px;padding-right: 20px"><button class="btn-primary" onclick="javaScript:$('#logout').modal('show')">退出</button></div>
<ul class="nav nav-tabs">
    <li class="active"><a href="/">首页</a></li>
    <li><a href="/order/page">待卖出订单</a></li>
    <li><a href="/socket/page">日志</a></li>
    <li><a href="/user/conf">参数配置</a></li>
    <li><a href="/user/page">用户</a></li>

</ul>
<div class="content">
    <span>开盘价格：</span><span style="padding-left: 15px;padding-right: 15px" id="open">-</span>
    <span>最高价格：</span><span style="padding-left: 15px;padding-right: 15px" id="high">-</span>
    <span>最低价格：</span><span style="padding-left: 15px;padding-right: 15px" id="low">-</span>
    <span>收盘价格：</span><span style="padding-left: 15px;padding-right: 15px" id="close">-</span>
    <table class="table" style="width: 500px;margin-left: 50px">
        <caption>持仓信息</caption>
        <thead>
        <tr>
            <th>多仓数量 :</th>
            <th id="long_qty">-</th>
        </tr>
        <tr>
            <th>多仓可平仓数量 :</th>
            <th id="long_avail_qty">-</th>
        </tr>
        <tr>
            <th>开仓平均价 :</th>
            <th id="long_avg_cost">-</th>
        </tr>
        <tr>
            <th>已实现盈余 :</th>
            <th id="realised_pnl">-</th>
        </tr>
        <tr>
            <th>空仓数量 :</th>
            <th id="short_qty">-</th>
        </tr>
        <tr>
            <th>空仓保证金 :</th>
            <th id="short_margi">-</th>
        </tr>
        <tr>
            <th>空仓可平仓数量 :</th>
            <th id="short_avail_qty">-</th>
        </tr>
        <tr>
            <th>空仓收益 :</th>
            <th id="short_pnl">-</th>
        </tr>
        <tr>
            <th>空仓收益率 :</th>
            <th id="short_pnl_ratio">-</th>
        </tr>
        <tr>
            <th>多仓保证金 :</th>
            <th id="long_margin">-</th>
        </tr>
        <tr>
            <th>多仓收益 :</th>
            <th id="long_pnl">-</th>
        </tr>
        <tr>
            <th>多仓收益率 :</th>
            <th id="long_pnl_ratio">-</th>
        </tr>
        <tr>
            <th>多仓未实现盈亏 :</th>
            <th id="long_unrealised_pnl">-</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>
<div id="footer" style="text-align: center"></div>
</body>
<script>
    $(function () {
        setInterval(function(){
            $.ajax({
                type: 'GET',
                url: '/hold/info',
                dataType: 'json',
                cache: false,//false是不缓存，true为缓存
                async: true,//true为异步，false为同步
                success: function (rs) {
                    if (rs.code == 0) {
                        if (rs.data != null) {
                            $("#long_qty").text(rs.data.long_qty)
                            $("#long_avail_qty").text(rs.data.long_avail_qty)
                            $("#long_avg_cost").text(rs.data.long_avg_cost)
                            $("#realised_pnl").text(rs.data.realised_pnl)
                            $("#short_qty").text(rs.data.short_qty)
                            $("#short_margi").text(rs.data.short_margi)
                            $("#short_avail_qty").text(rs.data.short_avail_qty)
                            $("#short_pnl_ratio").text(rs.data.short_pnl_ratio)
                            $("#short_pnl").text(rs.data.short_pnl)
                            $("#long_margin").text(rs.data.long_margin)
                            $("#long_pnl").text(rs.data.long_pnl)
                            $("#long_pnl_ratio").text(rs.data.long_pnl_ratio)
                            $("#long_unrealised_pnl").text(rs.data.long_unrealised_pnl)


                        }
                    } else {
                        toastr.error(rs.msg);
                    }
                }
            });

            $.ajax({
                type: 'GET',
                url: '/kline',
                dataType: 'json',
                cache: false,//false是不缓存，true为缓存
                async: true,//true为异步，false为同步
                success: function (rs) {
                    if (rs.code == 0) {
                        if (rs.data != null) {
                            $(document).attr("title","首页-"+rs.data.close);
                            $("#open").text(rs.data.open);
                            $("#close").text(rs.data.close);
                            $("#high").text(rs.data.high);
                            $("#low").text(rs.data.low);
                        }
                    } else {
                        toastr.error(rs.msg);
                    }
                }
            });

        }, 1000)


    });
    function preview(file){
        if (file.files && file.files[0]){
            var reader = new FileReader();
            reader.onload = function(evt){
                $("#preview").html('<img src="' + evt.target.result + '" width="95px" height="50px" />');
            }
            reader.readAsDataURL(file.files[0]);
        }else{
            $("#preview").html('<p style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src=\'' + file.value + '\'"></p>');
        }
    }
</script>
</html>